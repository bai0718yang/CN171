{% extends 'base.html' %}

{% block self_head_css_js %}
<script src="/static/layer/layer.js"></script>
<script src="/static/js/base.js"></script>
<script src="/static/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="/static/plugins/datatables/dataTables.bootstrap.css"></script>

<script src="/static/incubator-echarts-4.4.0-dist/echarts.min.js"></script>
{% endblock %}
{% block content %}

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h4>智能告警分析</h4>
    </section>
    <!-- Main content -->
    <section class="content">
        {% csrf_token %}
        <div class="box">
            <div class="box-body" align="center">
                <div class="div1" id="main1" style="width: 600px;height:400px;"></div>
                <div class="div2" id="main2" style="width: 600px;height:400px;"></div>
            </div>
        </div>
        <form action="" method="post" id="pbossMakeRecordForm">
            <div class="box">
                <div class="box-header">
                    <div class="form-group form-inline input-daterange">
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label>告警类别:  &nbsp;</label>
                        <input type="text" name="warningType" id="type">
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label>告警状态:  &nbsp;</label>
                        <span style="overflow:hidden;">
                            <select style="width:174px;height:26px;" onchange="this.parentNode.nextSibling.value=this.value" id="status">
                                <option>未启动</option>
                                <option>处理中</option>
                                <option>转人工</option>
                                <option selected>已解决</option>
                            </select>
                        </span>
                        <!--<input type="text" name="warningStatus" id="status">-->
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <div class="btn-group">
                            <a id="make" style="display: none" href="#" class="btn btn-success" onclick="">查 询</a>
                        </div>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body" align="center">
                    <table class="table table-striped table-bordered" id="dataform">
                        <!--<caption style="caption-side:top;font-size:18px;font-weight:900;font-family:12px'微软雅黑';color:#333">
                            物联网PBOSS系统告警处理进展
                        </caption>-->
                        <thead>
                            <tr>
                                <th width="5%" style="text-align:center;vertical-align:middle;">序号</th>
                                <th width="50%" style="text-align:center;vertical-align:middle;">告警内容</th>
                                <th width="5%" style="text-align:center;vertical-align:middle;">数量</th>
                                <th width="10%" style="text-align:center;vertical-align:middle;">告警状态</th>
                                <th width="30%" style="text-align:center;vertical-align:middle;">告警分析</th>
                            </tr>
                        </thead>
                        <tbody id="warning">
                            <tr>
                                <td width="5%" style="text-align:center;vertical-align:middle;">1</td>
                                <td width="50%"
                                    style="text-align:center;vertical-align:middle;word-break:break-all;overflow:hidden;">
                                    【业务告警】目前系统环节积压订单达到66334笔，靠前省份有5710省66333笔，5910省1笔。
                                </td>
                                <td width="5%" style="text-align:center;vertical-align:middle;">8</td>
                                <td width="10%" style="text-align:center;vertical-align:middle;">处理中</td>
                                <td width="30%" style="text-align:center;vertical-align:middle;">
                                    积压订单在正常处理，省侧上发量大导致，已联系浙江省减少上发
                                </td>
                            </tr>
                            <tr>
                                <td width="5%" style="text-align:center;vertical-align:middle;">2</td>
                                <td width="50%"
                                    style="text-align:center;vertical-align:middle;word-break:break-all;overflow:hidden;">
                                    【业务告警】FTP下载异常，下载远程FTP服务器【IP=10.255.242.71:21】的文件【/outgoing/PBSS/newdataconsis/data/BOSS_PB_DELETE_20191021150000_2001591.0000014131.gz】失败，失败原因为：该文件已存在于【IP=172.16.126.149】localCatalog目录下
                                </td>
                                <td width="5%" style="text-align:center;vertical-align:middle;">4</td>
                                <td width="10%" style="text-align:center;vertical-align:middle;">处理中</td>
                                <td width="30%" style="text-align:center;vertical-align:middle;">
                                    省侧重复上传文件，需省侧确认后解决
                                </td>
                            </tr>
                            <tr>
                                <td width="5%" style="text-align:center;vertical-align:middle;">3</td>
                                <td width="50%"
                                    style="text-align:center;vertical-align:middle;word-break:break-all;overflow:hidden;">
                                    【业务告警】目前系统环节积压订单达到66334笔，靠前省份有5710省66333笔，5910省1笔。
                                </td>
                                <td width="5%" style="text-align:center;vertical-align:middle;">8</td>
                                <td width="10%" style="text-align:center;vertical-align:middle;">处理中</td>
                                <td width="30%" style="text-align:center;vertical-align:middle;">
                                    积压订单在正常处理，省侧上发量大导致，已联系浙江省减少上发
                                </td>
                            </tr>
                            <tr>
                                <td width="5%" style="text-align:center;vertical-align:middle;">4</td>
                                <td width="50%"
                                    style="text-align:center;vertical-align:middle;word-break:break-all;overflow:hidden;">
                                    【业务告警】目前系统环节积压订单达到66334笔，靠前省份有5710省66333笔，5910省1笔。
                                </td>
                                <td width="5%" style="text-align:center;vertical-align:middle;">8</td>
                                <td width="10%" style="text-align:center;vertical-align:middle;">处理中</td>
                                <td width="30%" style="text-align:center;vertical-align:middle;">
                                    积压订单在正常处理，省侧上发量大导致，已联系浙江省减少上发
                                </td>
                            </tr>
                            <tr>
                                <td width="5%" style="text-align:center;vertical-align:middle;">5</td>
                                <td width="50%"
                                    style="text-align:center;vertical-align:middle;word-break:break-all;overflow:hidden;">
                                    【业务告警】目前系统环节积压订单达到66334笔，靠前省份有5710省66333笔，5910省1笔。
                                </td>
                                <td width="5%" style="text-align:center;vertical-align:middle;">8</td>
                                <td width="10%" style="text-align:center;vertical-align:middle;">处理中</td>
                                <td width="30%" style="text-align:center;vertical-align:middle;">
                                    积压订单在正常处理，省侧上发量大导致，已联系浙江省减少上发
                                </td>
                            </tr>
                            <tr>
                                <td width="5%" style="text-align:center;vertical-align:middle;">6</td>
                                <td width="50%"
                                    style="text-align:center;vertical-align:middle;word-break:break-all;overflow:hidden;">
                                    【业务告警】目前系统环节积压订单达到66334笔，靠前省份有5710省66333笔，5910省1笔。
                                </td>
                                <td width="5%" style="text-align:center;vertical-align:middle;">8</td>
                                <td width="10%" style="text-align:center;vertical-align:middle;">处理中</td>
                                <td width="30%" style="text-align:center;vertical-align:middle;">
                                    积压订单在正常处理，省侧上发量大导致，已联系浙江省减少上发
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </form>
    </section>
    <!-- /.content -->
</div>

<style>
.div1 {
float: left;
}
.div2 {
float: right;
}

</style>

<script type="text/javascript">
    echart_1();
    echart_2();
    //echart_1告警数量
    function echart_1() {
        //基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main1'));
        myChart.clear();
	    window.addEventListener('resize', function () {
		    myChart.resize();
	    });
	    var data1 = [8, 6, 7, 8, 9];
	    var data2 = [15, 10, 20, 14, 15];
	    setInterval(function () {
	        data1.shift();
	        data1.push(Math.round(Math.random() * 30));
	        data2.shift();
	        data2.push(data1[4] + Math.round(Math.random() * 10));
	    series_data = [
	        {
	            name: '待解决告警数',
                type: 'bar',
                barGap: '-100%',
                barWidth: '20%',
                xAxisIndex: 1,
                itemStyle: {
                    normal: {
                        color: function(params) {
						    var colorList = ['rgba(65, 105, 225, 1)', 'rgba(255, 255, 0, 1)', 'rgba(60, 179, 113, 1)',
							    			 'rgba(0, 255, 255, 1)', 'rgba(106, 90, 205, 1)'];
						    return colorList[params.dataIndex]
					    },
                    },
                    emphasis: {
                        opacity: 1
                    }
                },
                data: data1,
            },
            {
                name: '告警总数',
                type: 'bar',
			    barGap: '-100%',
                barWidth: '20%',
                xAxisIndex: 1,
                itemStyle: {
                    normal: {
                        color: function(params) {
						    var colorList = ['rgba(65, 105, 225, 0.3)', 'rgba(255, 255, 0, 0.3)', 'rgba(60, 179, 113, 0.3)',
							    			 'rgba(0, 255, 255, 0.3)', 'rgba(106, 90, 205, 0.3)'];
						    return colorList[params.dataIndex]
					    },
                    },
                    emphasis: {
                        opacity: 1
                    }
                },
                data: data2,
            },
        ]
	    option = {
		    title: {
		        top: '5%',
                text: '物联网PBOSS系统实时告警数量',
                x: 'center'
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                top: '30%',
                left: '5%',
                right: '0%',
                bottom: '5%',
                containLabel: true
            },
		    xAxis:
		    [
			    {
				    type: 'category',
				    data: ['环节积压','环节异常','集群/应用异常','磁盘/表空间告警','其他'],
				    axisLabel:{
					    interval: 0
				    },
				    boundaryGap: true,
			    },
			    {
				    type: 'category',
				    position: "bottom",
				    data: ['环节积压', '环节异常', '集群/应用异常', '磁盘/表空间告警', '其他'],
				    axisLabel:{
				    	interval: 0
				    },
				    boundaryGap: true,
				    splitLine: {
					    show: false
				    },
				    axisTick: {
					    show: false
				    },
				    axisLine: {
					    lineStyle: {
						    color: '#000'
					    }
				    },
			    },
		    ],
		    yAxis:
		    {
		        name: '告警数量/小时',
                type: "value",
                splitLine: {
                    lineStyle: {
                        color: 'rgba(0, 0, 0, 0.2)'
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: '#000'
                    }
                },
		    },
		    series: series_data
	    }
	    myChart.setOption(option);
	    },5000);}
    //echart_2KPI指标
    function echart_2() {
        //基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main2'));
        myChart.clear();
        option = {
            title: {
                top: '5%',
                text: '物联网PBOSS系统KPI指标',
                x: 'center'
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                top: '30%',
                left: '0%',
                right: '5%',
                bottom: '10%',
                containLabel: true
            },
            legend: {
                top: '20%',
			    icon: 'rect',
                data: ['业务查询-成功率','订购同步-成功率','PBOSS系统可用性'],
                align: 'right',
                textStyle: {
                    color: "#000"
                },
                itemWidth: 20,
                itemHeight: 4,
                itemGap: 15
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['1日' ,'2日' ,'3日' ,'4日' ,'5日' ,'6日' ,'7日' ,'8日' ,'9日' ,'10日','11日','12日','13日','14日','15日','16日',
				       '17日','18日','19日','20日','21日','22日','23日','24日','25日','26日','27日','28日','29日','30日','31日'],
                splitLine: {
                    show: false
                },
                axisLine: {
                    lineStyle: {
                        color: '#000'
                    }
                }
            },
            yAxis: {
                // name: 'KPI指标/%',
                type: 'value',
			    scale: true,
			    max: function(value) {
				    return value.max;
			    },
			    min: function(value) {
				    return value.min - 0.1;
			    },
                splitLine: {
                    lineStyle: {
                    color: 'rgba(0, 0, 0, 0.3)'
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: '#000'
                    }
                }
            },
            series: [
			    {
				    type: 'line',
				    markLine: {
					    name: '基准线',
				        type: 'line',
				        symbol: 'none',
					    lineStyle: {
						    normal: {
							    width: 1.5,
							    color: '#01FEF9'
						    }
                        },
					    data: [{
                            yAxis: 99.9
                        }],
					    label: {
						    normal: {
							    position: 'middle',
							    formatter: '达标值'
						    }
                        },
				    }
			    },
                {
                    name: '业务查询-成功率',
				    smooth: true,
                    type: 'line',
				    symbol: 'circle',
				    areaStyle: {
					    normal: {
						    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
							    offset: 0,
							    color: 'rgba(255, 255, 0, 0.5)'
						    }, {
							    offset: 0.8,
							    color: 'rgba(255, 255, 0, 0.05)'
						    }], false),
						    shadowColor: 'rgba(0, 0, 0, 0.2)',
						    shadowBlur: 10
					    }
				    },
				    itemStyle: {
					    normal: {
						    color: '#FFFF00',
						    borderColor: 'rgba(255, 255, 0, 0.3)',
						    borderWidth: 10
					    }
				    },
                    data:[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100]
                },
			    {
                    name: '订购同步-成功率',
				    smooth: true,
                    type: 'line',
				    symbol: 'circle',
				    areaStyle: {
					    normal: {
						    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
							    offset: 0,
							    color: 'rgba(60, 179, 113, 0.5)'
						    }, {
							    offset: 0.8,
							    color: 'rgba(60, 179, 113, 0.05)'
						    }], false),
						    shadowColor: 'rgba(0, 0, 0, 0.2)',
						    shadowBlur: 10
					    }
				    },
				    itemStyle: {
					    normal: {
						    color: '#3CB371',
						    borderColor: 'rgba(60, 179, 113, 0.3)',
						    borderWidth: 10
					    }
				    },
                    data:[99.99,99.99,99.99,99.99,100,100,100,100,100,100,100,100,100,100,100,99.97,
				          99.99,100,99.99,100,100,100,99.98,100,100,100,99.99,100,99.99,100,99.97]
                },
                {
                    name: 'PBOSS系统可用性',
				    smooth: true,
                    type: 'line',
				    symbol: 'circle',
				    areaStyle: {
					    normal: {
						    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
							    offset: 0,
							    color: 'rgba(65, 105, 225, 0.5)'
						    }, {
							    offset: 0.8,
							    color: 'rgba(65, 105, 225, 0.05)'
						    }], false),
						    shadowColor: 'rgba(0, 0, 0, 0.2)',
						    shadowBlur: 10
					    }
				    },
				    itemStyle: {
					    normal: {
						    color: '#4169E1',
						    borderColor: 'rgba(65, 105, 225, 0.3)',
						    borderWidth: 10
					    }
				    },
                    data:[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100]
                 }
            ]
        };
        myChart.setOption(option);
    }

</script>
<script type="text/javascript">
	function change(table){
		var row = table.insertRow(table.rows.length);
		for(j = 0; j < table.rows[0].cells.length; j++){
			var cell = row.insertCell(j);
			cell.height = "24px";
			cell.style.cssText= "text-align:center;vertical-align:middle;word-break:break-all;overflow:hidden;";
			cell.innerHTML += table.rows[0].cells[j].innerHTML;
		}
		table.deleteRow(0);
	};
	function tableInterval(){
		var table = document.getElementById("warning");
		change(table);
	};
	setInterval("tableInterval()", 1000);
</script>

{% endblock %}